<?xml version="1.0"?>

<system>

	<channel name="input from FG">
		<switch name="ic/sea-level-radius-ft">
			<default value="0.0"/>
			<test logic="AND" value="/position/sea-level-radius-ft">
				simulation/sim-time-sec GT 0.1
			</test>
		</switch>
	</channel>

	<channel name="Orbital">

		<!-- Orbit parameters calculation -->

		<fcs_function name="systems/orbital/semimajor-axis-length-ft">
		<description>
			This equation calculates the semimajor-axis length in feet. a = mu/(2*mu/r - v^2) 
		</description>
		<function>
			<quotient>
				<p> systems/orbital/gm </p>
				<difference>
					<quotient>
						<product>
							<v> 2.0 </v>
							<p> systems/orbital/gm </p>
						</product>
						<p> position/radius-to-vehicle-ft </p>
					</quotient>
					<pow>
						<p> velocities/eci-velocity-mag-fps </p>
						<v> 2.0 </v>
					</pow>
				</difference>
			</quotient>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/eccentricity">
		<description>
			This equation calculates eccentricity. e = sqrt (1 - [ r v cos(gamma) ]^2 / {a * mu})
		</description>
		<function>
			<pow>
				<difference>
					<value> 1.0 </value>
					<quotient>
						<pow>
							<product>
								<property> position/radius-to-vehicle-ft </property>
								<property> velocities/eci-velocity-mag-fps </property>
								<cos>
									<property> flight-path/gamma-rad </property>
								</cos>
							</product>
							<value> 2.0 </value>
						</pow>
						<product>
							<property> systems/orbital/semimajor-axis-length-ft </property>
							<property> systems/orbital/gm </property>
						</product>
					</quotient>
				</difference>
				<value> 0.5 </value>
			</pow>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/apoapsis-ft">
		<function>
			<difference>
				<product>
					<property>systems/orbital/semimajor-axis-length-ft</property>
					<sum>
						<value>1</value>
						<property>systems/orbital/eccentricity</property>
					</sum>
				</product>
				<property>ic/sea-level-radius-ft</property>
			</difference>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/apoapsis-km">
		<function>
			<quotient>
				<property>systems/orbital/apoapsis-ft</property>
				<value>3280.83989501312335958005</value>
			</quotient>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/apoapsis-indicated-km">
		<function>
			<table>
				<independentVar lookup="row">systems/orbital/apoapsis-km</independentVar>
				<tableData>
					-1.0		0.0
					0.0		0.0
					9999.0		9999.0
					10000.0		9999.0
				</tableData>
			</table>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/apoapsis-hundreds-km">
		<function>
			<integer>	
				<quotient>
					<property>systems/orbital/apoapsis-indicated-km</property>
					<value>100</value>
				</quotient>
			</integer>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/apoapsis-tens-km">
		<function>
			<integer>	
				<product>
					<fraction>
						<quotient>
							<property>systems/orbital/apoapsis-indicated-km</property>
							<value>100</value>
						</quotient>
					</fraction>
					<value>10</value>
				</product>
			</integer>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/apoapsis-ones-km">
		<function>
			<integer>	
				<product>
					<fraction>
						<quotient>
							<property>systems/orbital/apoapsis-indicated-km</property>
							<value>10</value>
						</quotient>
					</fraction>
					<value>10</value>
				</product>
			</integer>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/periapsis-ft">
		<function>
			<difference>
				<product>
					<property>systems/orbital/semimajor-axis-length-ft</property>
					<difference>
						<value>1</value>
						<property>systems/orbital/eccentricity</property>
					</difference>
				</product>
				<property>ic/sea-level-radius-ft</property>
			</difference>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/periapsis-km">
		<function>
			<quotient>
				<property>systems/orbital/periapsis-ft</property>
				<value>3280.83989501312335958005</value>
			</quotient>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/periapsis-indicated-km">
		<function>
			<table>
				<independentVar lookup="row">systems/orbital/periapsis-km</independentVar>
				<tableData>
					-1.0		0.0
					0.0		0.0
					9999.0		9999.0
					10000.0		9999.0
				</tableData>
			</table>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/periapsis-hundreds-km">
		<function>
			<integer>	
				<quotient>
					<property>systems/orbital/periapsis-indicated-km</property>
					<value>100</value>
				</quotient>
			</integer>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/periapsis-tens-km">
		<function>
			<integer>	
				<product>
					<fraction>
						<quotient>
							<property>systems/orbital/periapsis-indicated-km</property>
							<value>100</value>
						</quotient>
					</fraction>
					<value>10</value>
				</product>
			</integer>
		</function>
		</fcs_function>

		<fcs_function name="systems/orbital/periapsis-ones-km">
		<function>
			<integer>	
				<product>
					<fraction>
						<quotient>
							<property>systems/orbital/periapsis-indicated-km</property>
							<value>10</value>
						</quotient>
					</fraction>
					<value>10</value>
				</product>
			</integer>
		</function>
		</fcs_function>

	</channel>

</system>
