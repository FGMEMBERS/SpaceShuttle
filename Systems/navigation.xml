<?xml version="1.0"?>

<system>

	<channel name="Radar altimeter" execrate="4">

		<switch name="systems/navigation/radar-alt-available">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/navigation/rdr-altm == 1
				systems/navigation/radar-altimeter-1-power == 1
				systems/electrical/bus/voltage GT 26.0
			</test>
			<test logic="AND" value="1.0">
				systems/navigation/rdr-altm == 0
				systems/navigation/radar-altimeter-2-power == 1
				systems/electrical/bus[1]/voltage GT 26.0
			</test>
		</switch>
	
		<sensor name="systems/navigation/radar-alt-ft">
			<input>position/h-agl-ft</input>
			<lag>0.1</lag>
			<noise variation="PERCENT" distribution="GAUSSIAN">0.01</noise>
			<output>systems/navigation/radar-altitude-ft</output>
		</sensor>
	</channel>

	<channel name="TACAN receivers" execrate="4">

		<switch name="systems/navigation/tacan/operational">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/navigation/tacan-sys1-switch GT 0
				systems/electrical/bus/voltage GT 26.0
				systems/failures/navigation/tacan-1-condition GT 0
			</test>
		</switch>

		<switch name="systems/navigation/tacan[1]/operational">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/navigation/tacan-sys2-switch GT 0
				systems/electrical/bus[1]/voltage GT 26.0
				systems/failures/navigation/tacan-2-condition GT 0
			</test>
		</switch>

		<switch name="systems/navigation/tacan[2]/operational">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/navigation/tacan-sys3-switch GT 0
				systems/electrical/bus[2]/voltage GT 26.0
				systems/failures/navigation/tacan-3-condition GT 0
			</test>
		</switch>

		<switch name="systems/navigation/tacan-available">
			<default value="0.0"/>
			<test logic="OR" value="1.0">
				systems/navigation/tacan/operational == 1
				systems/navigation/tacan[1]/operational == 1
				systems/navigation/tacan[2]/operational == 1
			</test>
		</switch>


		<fcs_function name="systems/navigation/tacan1-power-demand-kW">
		<function>
			<product>
				<property>systems/navigation/tacan-sys1-switch</property>
				<value>0.050</value>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/tacan2-power-demand-kW">
		<function>
			<product>
				<property>systems/navigation/tacan-sys2-switch</property>
				<value>0.050</value>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/tacan3-power-demand-kW">
		<function>
			<product>
				<property>systems/navigation/tacan-sys3-switch</property>
				<value>0.050</value>
			</product>
		</function>
		</fcs_function>
		
	</channel>

	<channel name="MLS receivers" execrate="4">

		<switch name="systems/navigation/mls-available">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/navigation/mls-sys1-switch == 1
				systems/electrical/bus/voltage GT 26.0
			</test>
			<test logic="AND" value="1.0">
				systems/navigation/mls-sys2-switch == 1
				systems/electrical/bus[1]/voltage GT 26.0
			</test>
			<test logic="AND" value="1.0">
				systems/navigation/mls-sys3-switch == 1
				systems/electrical/bus[2]/voltage GT 26.0
			</test>
		</switch>
		
	</channel>

	<channel name="GPS unit" execrate="4">

		<switch name="systems/navigation/gps-available">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/navigation/gps-power-switch == 1
				systems/navigation/gps-preamp-1-switch == 1
				systems/electrical/bus[1]/voltage GT 26.0
				systems/electrical/bus/voltage GT 26.0
				systems/failures/navigation/gps-condition == 1
			</test>
			<test logic="AND" value="1.0">
				systems/navigation/gps-power-switch == -1
				systems/navigation/gps-preamp-1-switch == -1
				systems/electrical/bus[1]/voltage GT 26.0
				systems/electrical/bus[2]/voltage GT 26.0
				systems/failures/navigation/gps-condition == 1
			</test>
			<test logic="AND" value="1.0">
				systems/navigation/gps-power-switch == 1
				systems/navigation/gps-preamp-2-switch == 1
				systems/electrical/bus[1]/voltage GT 26.0
				systems/electrical/bus[2]/voltage GT 26.0
				systems/failures/navigation/gps-condition == 1
			</test>
			<test logic="AND" value="1.0">
				systems/navigation/gps-power-switch == 1
				systems/navigation/gps-preamp-2-switch == -1
				systems/electrical/bus[1]/voltage GT 26.0
				systems/electrical/bus/voltage GT 26.0
				systems/failures/navigation/gps-condition == 1
			</test>
		</switch>
		
	</channel>

	<channel name="Air data probes">

		<switch name="systems/navigation/air-data-left-target">
			<default value="systems/navigation/air-data-left-pos"/>
			<test logic="AND" value="1.0">
				systems/electrical/total-available-power-kW GT 0.0
				systems/navigation/air-data-deploy-left-switch == 1
			</test>
			<test logic="AND" value="0.0">
				systems/electrical/total-available-power-kW GT 0.0
				systems/navigation/air-data-deploy-left-switch == 0
				systems/navigation/air-data-stow-left-switch == 1
			</test>
		</switch>

		<switch name="systems/navigation/air-data-right-target">
			<default value="systems/navigation/air-data-right-pos"/>
			<test logic="AND" value="1.0">
				systems/electrical/total-available-power-kW GT 0.0
				systems/navigation/air-data-deploy-right-switch == 1
			</test>
			<test logic="AND" value="0.0">
				systems/electrical/total-available-power-kW GT 0.0
				systems/navigation/air-data-deploy-right-switch == 0
				systems/navigation/air-data-stow-right-switch == 1
			</test>
		</switch>

		<kinematic name="systems/navigation/air-data-left-pos-kin">
			<input>systems/navigation/air-data-left-target</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>15.0</time>
				</setting>
			</traverse>
		</kinematic>

		<kinematic name="systems/navigation/air-data-right-pos-kin">
			<input>systems/navigation/air-data-right-target</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>15.0</time>
				</setting>
			</traverse>
		</kinematic>

		<fcs_function name="systems/navigation/air-data-left-pos">
		<function>
			<product>
				<property>systems/navigation/air-data-left-pos-kin</property>
				<property>systems/failures/navigation/air-data-probe-left-condition</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/air-data-right-pos">
		<function>
			<product>
				<property>systems/navigation/air-data-right-pos-kin</property>
				<property>systems/failures/navigation/air-data-probe-right-condition</property>
			</product>
		</function>
		</fcs_function>

		<switch name="systems/navigation/air-data-left-deployed">
			<default value="0"/>
			<test  value="1.0">
				systems/navigation/air-data-left-pos == 1.0
			</test>
		</switch>

		<switch name="systems/navigation/air-data-right-deployed">
			<default value="0"/>
			<test  value="1.0">
				systems/navigation/air-data-right-pos == 1.0
			</test>
		</switch>

		<switch name="systems/navigation/air-data-available">
			<default value="0"/>
			<test  value="1.0">
				systems/navigation/air-data-left-deployed == 1.0
			</test>
			<test  value="1.0">
				systems/navigation/air-data-right-deployed == 1.0
			</test>
		</switch>

		<sensor name="systems/navigation/air-data-alt-ft-raw">
			<input>/position/altitude-ft</input>
			<lag>0.3</lag>
			<noise variation="PERCENT" distribution="GAUSSIAN">0.0001</noise>
		</sensor>

		<sensor name="systems/navigation/air-data-alpha-raw">
			<input>aero/alpha-deg</input>
			<lag>0.3</lag>
			<noise variation="PERCENT" distribution="GAUSSIAN">0.0001</noise>
		</sensor>

		<sensor name="systems/navigation/air-data-mach-raw">
			<input>velocities/mach</input>
			<lag>0.3</lag>
			<noise variation="PERCENT" distribution="GAUSSIAN">0.0001</noise>
		</sensor>



	</channel>


	<channel name="IMU accelerometers">

		<accelerometer name="systems/navigation/acc-x">
  			<location unit="M">
    				<x> 2.7 </x>
    				<y> 0.0 </y>
   				<z> -2.7 </z>
  			</location>
  			<orientation unit="DEG">
    				<pitch> 0.0 </pitch>
    				<roll>  0.0 </roll>
    				<yaw> 	0.0 </yaw>
  			</orientation>
  			<axis> X</axis>
  			<lag> 0.0 </lag>
  			<noise variation="PERCENT" distribution="GAUSSIAN"> 0.01 </noise>
			<output>systems/navigation/acceleration-x</output>
		</accelerometer>

		<accelerometer name="systems/navigation/acc-y">
  			<location unit="M">
    				<x> 2.7 </x>
    				<y> 0.0 </y>
   				<z> -2.7 </z>
  			</location>
  			<orientation unit="DEG">
    				<pitch> 0.0 </pitch>
    				<roll>  0.0 </roll>
    				<yaw> 	0.0 </yaw>
  			</orientation>
  			<axis> Y</axis>
  			<lag> 0.0 </lag>
  			<noise variation="PERCENT" distribution="GAUSSIAN"> 0.01 </noise>
			<output>systems/navigation/acceleration-y</output>
		</accelerometer>

		<accelerometer name="systems/navigation/acc-z">
  			<location unit="M">
    				<x> 2.7 </x>
    				<y> 0.0 </y>
   				<z> -2.7 </z>
  			</location>
  			<orientation unit="DEG">
    				<pitch> 0.0 </pitch>
    				<roll>  0.0 </roll>
    				<yaw> 	0.0 </yaw>
  			</orientation>
  			<axis> Z</axis>
  			<lag> 0.0 </lag>
  			<noise variation="PERCENT" distribution="GAUSSIAN"> 0.01 </noise>
			<output>systems/navigation/acceleration-z</output>
		</accelerometer>

	</channel>

	<channel name="PASS computation failures">
		
		<actuator name="systems/navigation/state-vector/pass/error-pitch">
			<input>systems/dps/pass/error-pitch</input>
			<rate_limit>0.5</rate_limit>
		</actuator>

		<actuator name="systems/navigation/state-vector/pass/error-yaw">
			<input>systems/dps/pass/error-yaw</input>
			<rate_limit>0.5</rate_limit>
		</actuator>

		<actuator name="systems/navigation/state-vector/pass/error-roll">
			<input>systems/dps/pass/error-roll</input>
			<rate_limit>0.5</rate_limit>
		</actuator>

	</channel>

	<channel name="Merged computation errors">
	
		<fcs_function name="systems/navigation/state-vector/merge/error-pitch-dps">
		<function>
			<product>
				<difference>
					<value>1.0</value>
					<property>systems/dps/bfs-in-control</property>
				</difference>
				<property>systems/navigation/state-vector/pass/error-pitch</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/error-yaw-dps">
		<function>
			<product>
				<difference>
					<value>1.0</value>
					<property>systems/dps/bfs-in-control</property>
				</difference>
				<property>systems/navigation/state-vector/pass/error-yaw</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/error-roll-dps">
		<function>
			<product>
				<difference>
					<value>1.0</value>
					<property>systems/dps/bfs-in-control</property>
				</difference>
				<property>systems/navigation/state-vector/pass/error-roll</property>
			</product>
		</function>
		</fcs_function>

	</channel>

	<channel name="State vector">

		<fcs_function name="systems/navigation/state-vector/merge/pitch-deg-A">
		<function>
			<sum>
				<property>/orientation/pitch-deg</property>
				<product>
					<property>systems/navigation/state-vector/error-prop/pitch-deg</property>
					<property>systems/navigation/state-vector/use-realistic-sv</property>
				</product>
				<property>systems/navigation/state-vector/merge/error-pitch-dps</property>
			</sum>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/pitch-deg-B">
		<function>
			<difference>
				<value>180.0</value>
				<property>systems/navigation/state-vector/merge/pitch-deg-A</property>
			</difference>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/pitch-deg-C">
		<function>
			<difference>
				<value>-180.0</value>
				<property>systems/navigation/state-vector/merge/pitch-deg-A</property>
			</difference>
		</function>
		</fcs_function>

		<switch name="systems/navigation/state-vector/pitch-deg">
			<default value="systems/navigation/state-vector/merge/pitch-deg-A"/>
			<test value="systems/navigation/state-vector/merge/pitch-deg-B">
				systems/navigation/state-vector/merge/pitch-deg-A GT 90.0
			</test>
			<test value="systems/navigation/state-vector/merge/pitch-deg-C">
				systems/navigation/state-vector/merge/pitch-deg-A LT -90.0 
			</test>

		</switch>

		<fcs_function name="systems/navigation/state-vector/merge/yaw-deg-A">
		<function>
			<sum>
				<property>/orientation/heading-deg</property>
				<product>
					<property>systems/navigation/state-vector/error-prop/yaw-deg</property>
					<property>systems/navigation/state-vector/use-realistic-sv</property>
				</product>
				<property>systems/navigation/state-vector/merge/error-yaw-dps</property>
			</sum>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/yaw-deg-B">
		<function>
			<difference>
				<property>systems/navigation/state-vector/merge/yaw-deg-A</property>
				<value>360.0</value>
			</difference>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/yaw-deg-C">
		<function>
			<sum>
				<property>systems/navigation/state-vector/merge/yaw-deg-A</property>
				<value>360.0</value>
			</sum>
		</function>
		</fcs_function>

		<switch name="systems/navigation/state-vector/yaw-deg">
			<default value="systems/navigation/state-vector/merge/yaw-deg-A"/>
			<test value="systems/navigation/state-vector/merge/yaw-deg-B">
				systems/navigation/state-vector/merge/yaw-deg-A GT 360.0
			</test>
			<test value="systems/navigation/state-vector/merge/yaw-deg-C">
				systems/navigation/state-vector/merge/yaw-deg-A LT 0.0 
			</test>

		</switch>

		<fcs_function name="systems/navigation/state-vector/merge/roll-deg-A">
		<function>
			<sum>
				<property>/orientation/roll-deg</property>
				<product>
					<property>systems/navigation/state-vector/error-prop/roll-deg</property>
					<property>systems/navigation/state-vector/use-realistic-sv</property>
				</product>
				<property>systems/navigation/state-vector/merge/error-roll-dps</property>
			</sum>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/roll-deg-B">
		<function>
			<difference>
				<property>systems/navigation/state-vector/merge/roll-deg-A</property>
				<value>360.0</value>
			</difference>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/merge/roll-deg-C">
		<function>
			<sum>
				<property>systems/navigation/state-vector/merge/roll-deg-A</property>
				<value>360.0</value>
			</sum>
		</function>
		</fcs_function>

		<switch name="systems/navigation/state-vector/roll-deg">
			<default value="systems/navigation/state-vector/merge/roll-deg-A"/>
			<test value="systems/navigation/state-vector/merge/roll-deg-B">
				systems/navigation/state-vector/merge/roll-deg-A GT 180.0
			</test>
			<test value="systems/navigation/state-vector/merge/roll-deg-C">
				systems/navigation/state-vector/merge/roll-deg-A LT -180 
			</test>

		</switch>


		<fcs_function name="systems/navigation/state-vector/latitude-deg">
		<function>
			<sum>
				<property>/position/latitude-deg</property>
				<product>
					<property>systems/navigation/state-vector/error-prop/latitude-deg</property>
					<property>systems/navigation/state-vector/use-realistic-sv</property>
				</product>
			</sum>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/longitude-deg">
		<function>
			<sum>
				<property>/position/longitude-deg</property>
				<product>
					<property>systems/navigation/state-vector/error-prop/longitude-deg</property>
					<property>systems/navigation/state-vector/use-realistic-sv</property>
				</product>
			</sum>
		</function>
		</fcs_function>

		<fcs_function name="systems/navigation/state-vector/altitude-ft">
		<function>
			<sum>
				<property>/position/altitude-ft</property>
				<product>
					<property>systems/navigation/state-vector/error-prop/altitude-ft</property>
					<property>systems/navigation/state-vector/use-realistic-sv</property>
				</product>
			</sum>
		</function>
		</fcs_function>

	</channel>

</system>
