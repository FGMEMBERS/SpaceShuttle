<?xml version="1.0"?>

<system>

	<channel name="FC 1">

		<switch name="systems/electrical/fc/fc-ready-to-start">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/fc/reactant-valve-status == 1
				systems/electrical/fc/fc-controller-power == 1
			</test>
		</switch>

		<switch name="systems/electrical/fc/fc-running">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/fc/fc-ready-to-start == 1
				systems/electrical/fc/fc-start-cmd == 1
			</test>
		</switch>

		<kinematic name="systems/electrical/fc/fc-ready-for-load-transit">
			<input>systems/electrical/fc/fc-running</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>30.0</time>
				</setting>
			</traverse>
		</kinematic>

		<switch name="systems/electrical/fc/fc-ready-for-load">
			<default value="0.0"/>
			<test  value="1.0">
				systems/electrical/fc/fc-ready-for-load-transit == 1
			</test>
		</switch>

		<fcs_function name="systems/electrical/fc/fc-max-power-output-kW">
		<function>	
			<product>
				<value>12.0</value>
				<property>systems/electrical/fc/fc-ready-for-load</property>
				<property>systems//failures/fc1-condition</property>
				<property>systems/electrical/fc/fc-efficiency</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/fc/coolant-pump-failure">
		<function>
			<difference>
				<value>1.0</value>
				<property>systems/failures/fc1-coolant-pump-condition</property>
			</difference>
		</function>
		</fcs_function>

		<kinematic name="systems/electrical/fc/overheat-transit">
			<input>systems/electrical/fc/coolant-pump-failure</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>540.0</time>
				</setting>
			</traverse>
		</kinematic>

		<fcs_function name="systems/electrical/fc/stack-temperature-K">
		<function>
			<max>
				<product>
				<sum>
					<value>359.5</value>
					<product>
						<quotient>
						<property>systems/electrical/bus1-power-demand-kW</property>
						<value>0.03</value>
						</quotient>
						<value>0.04418</value>
					</product>
				</sum>
				<property>systems/electrical/fc/fc-ready-for-load-transit</property>
				</product>
				<product>
				<sum>
					<value>359.5</value>
					<product>
						<property>systems/electrical/fc/overheat-transit</property>
						<value>65</value>
					</product>	
				</sum>
				<property>systems/electrical/fc/fc-ready-for-load-transit</property>
				</product>
				<property>systems/thermal-distribution/payload-bay-temperature-K</property>
			</max>
		</function>
		</fcs_function>



	</channel>


	<channel name="FC 2">

		<switch name="systems/electrical/fc[1]/fc-ready-to-start">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/fc[1]/reactant-valve-status == 1
				systems/electrical/fc[1]/fc-controller-power == 1
			</test>
		</switch>

		<switch name="systems/electrical/fc[1]/fc-running">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/fc[1]/fc-ready-to-start == 1
				systems/electrical/fc[1]/fc-start-cmd == 1
			</test>
		</switch>

		<kinematic name="systems/electrical/fc[1]/fc-ready-for-load-transit">
			<input>systems/electrical/fc[1]/fc-running</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>30.0</time>
				</setting>
			</traverse>
		</kinematic>

		<switch name="systems/electrical/fc[1]/fc-ready-for-load">
			<default value="0.0"/>
			<test  value="1.0">
				systems/electrical/fc[1]/fc-ready-for-load-transit == 1
			</test>
		</switch>

		<fcs_function name="systems/electrical/fc[1]/fc-max-power-output-kW">
		<function>	
			<product>
				<value>12.0</value>
				<property>systems/electrical/fc[1]/fc-ready-for-load</property>
				<property>systems/failures/fc2-condition</property>
				<property>systems/electrical/fc[1]/fc-efficiency</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/fc[1]/coolant-pump-failure">
		<function>
			<difference>
				<value>1.0</value>
				<property>systems/failures/fc2-coolant-pump-condition</property>
			</difference>
		</function>
		</fcs_function>

		<kinematic name="systems/electrical/fc[1]/overheat-transit">
			<input>systems/electrical/fc[1]/coolant-pump-failure</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>540.0</time>
				</setting>
			</traverse>
		</kinematic>

		<fcs_function name="systems/electrical/fc[1]/stack-temperature-K">
		<function>
			<max>
				<product>
				<sum>
					<value>359.5</value>
					<product>
						<quotient>
						<property>systems/electrical/bus2-power-demand-kW</property>
						<value>0.03</value>
						</quotient>
						<value>0.04418</value>
					</product>
				</sum>
				<property>systems/electrical/fc[1]/fc-ready-for-load-transit</property>
				</product>
				<product>
				<sum>
					<value>359.5</value>
					<product>
						<property>systems/electrical/fc[1]/overheat-transit</property>
						<value>65</value>
					</product>	
				</sum>
				<property>systems/electrical/fc[1]/fc-ready-for-load-transit</property>
				</product>
				<property>systems/thermal-distribution/payload-bay-temperature-K</property>
			</max>
		</function>
		</fcs_function>

	</channel>

	<channel name="FC 3">

		<switch name="systems/electrical/fc[2]/fc-ready-to-start">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/fc[2]/reactant-valve-status == 1
				systems/electrical/fc[2]/fc-controller-power == 1
			</test>
		</switch>

		<switch name="systems/electrical/fc[2]/fc-running">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/fc[2]/fc-ready-to-start == 1
				systems/electrical/fc[2]/fc-start-cmd == 1
			</test>
		</switch>

		<kinematic name="systems/electrical/fc[2]/fc-ready-for-load-transit">
			<default value="0.0"/>
			<input>systems/electrical/fc[2]/fc-running</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>30.0</time>
				</setting>
			</traverse>
		</kinematic>

		<switch name="systems/electrical/fc[2]/fc-ready-for-load">
			<default value="0.0"/>
			<test  value="1.0">
				systems/electrical/fc[2]/fc-ready-for-load-transit == 1
			</test>
		</switch>

		<fcs_function name="systems/electrical/fc[2]/fc-max-power-output-kW">
		<function>	
			<product>
				<value>12.0</value>
				<property>systems/electrical/fc[2]/fc-ready-for-load</property>
				<property>systems/failures/fc3-condition</property>
				<property>systems/electrical/fc[2]/fc-efficiency</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/fc[2]/coolant-pump-failure">
		<function>
			<difference>
				<value>1.0</value>
				<property>systems/failures/fc3-coolant-pump-condition</property>
			</difference>
		</function>
		</fcs_function>

		<kinematic name="systems/electrical/fc[2]/overheat-transit">
			<input>systems/electrical/fc[2]/coolant-pump-failure</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>540.0</time>
				</setting>
			</traverse>
		</kinematic>

		<fcs_function name="systems/electrical/fc[2]/stack-temperature-K">
		<function>
			<max>
			<product>
				<sum>
					<value>359.5</value>
					<product>
						<quotient>
						<property>systems/electrical/bus3-power-demand-kW</property>
						<value>0.03</value>
						</quotient>
						<value>0.04418</value>
					</product>
				</sum>
				<property>systems/electrical/fc[2]/fc-ready-for-load-transit</property>
			</product>
			<product>
				<sum>
					<value>359.5</value>
					<product>
						<property>systems/electrical/fc[2]/overheat-transit</property>
						<value>65</value>
					</product>	
				</sum>
				<property>systems/electrical/fc[2]/fc-ready-for-load-transit</property>
				</product>
			<property>systems/thermal-distribution/payload-bay-temperature-K</property>
			</max>
		</function>
		</fcs_function>

	</channel>

	<channel name="Line heater switches and temperatures">

		<fcs_function name="systems/electrical/h2o-line-heater-power-kW">
		<function>
			<product>
				<property>systems/electrical/h2o-line-heater-switch</property>
				<value>0.08</value>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/h2o-relief-heater-power-kW">
		<function>
			<product>
				<property>systems/electrical/h2o-relief-heater-switch</property>
				<value>0.08</value>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/purge-heater-power-kW">
		<function>
			<product>
				<property>systems/electrical/purge-heater-switch</property>
				<value>0.08</value>
			</product>
		</function>
		</fcs_function>

		<kinematic name="systems/electrical/purge-heater-transit">
			<input>systems/electrical/purge-heater-switch</input>
			<traverse>
				<setting>
					<position>0.0</position>
					<time>0.0</time>
				</setting>
				<setting>
					<position>1.0</position>
					<time>300.0</time>
				</setting>
			</traverse>
		</kinematic>

		<fcs_function name="systems/electrical/h2o-line-T">
		<function>
			<max>
			<product>
				<property>systems/electrical/h2o-line-heater-switch</property>
				<value>302.0</value>
			</product>
			<property>systems/thermal-distribution/payload-bay-temperature-K</property>
			</max>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/h2o-relief-T">
		<function>
			<max>
			<product>
				<property>systems/electrical/h2o-relief-heater-switch</property>
				<value>300.0</value>
			</product>
			<property>systems/thermal-distribution/payload-bay-temperature-K</property>
			</max>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/purge-line-T">
		<function>
			<max>
			<product>
				<property>systems/electrical/purge-heater-transit</property>
				<value>310.0</value>
			</product>
			<property>systems/thermal-distribution/payload-bay-temperature-K</property>
			</max>
		</function>
		</fcs_function>

	</channel>


      <h2o-line-heater-switch type="int">0</h2o-line-heater-switch>
      <h2o-relief-heater-switch type="int">0</h2o-relief-heater-switch>
      <purge-heater-switch type="int">0</purge-heater-switch>

	<channel name="Bus 1">

		<fcs_function name="systems/electrical/bus1-max-power-output-kW">
		<function>	
			<product>
				<property>systems/electrical/fc/fc-max-power-output-kW</property>
				<property>systems/electrical/fc/bus-connector-status</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/bus1-voltage">
		<function>
		<product>
		<table>
        		<independentVar lookup="row">systems/electrical/bus1-power-demand-kW</independentVar>
        		<tableData>
          	 		0.0	32.5
				12.0	27.5
        		</tableData>
      		</table>
		<property>systems/electrical/fc/fc-ready-for-load</property>
		<property>systems/electrical/fc/bus-connector-status</property>
		<property>systems/failures/fc1-condition</property>
		</product>
		</function>
		</fcs_function>

		<switch name="systems/electrical/bus1-power-available">
			<default value="0.0"/>
			<test  value="1.0">
				systems/electrical/bus1-max-power-output-kW GT 0.0
			</test>
		</switch>

		<switch name="systems/electrical/ac1-power-available">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/bus1-power-available == 1
				systems/electrical/ac/inverter-power-switch == 1
				systems/electrical/ac/inv-ac-switch == 1
			</test>
		</switch>

	</channel>

	<channel name="Bus 2">

		<fcs_function name="systems/electrical/bus2-max-power-output-kW">
		<function>	
			<product>
				<property>systems/electrical/fc[1]/fc-max-power-output-kW</property>
				<property>systems/electrical/fc[1]/bus-connector-status</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/bus2-voltage">
		<function>
		<product>
		<table>
        		<independentVar lookup="row">systems/electrical/bus2-power-demand-kW</independentVar>
        		<tableData>
          	 		0.0	32.5
				12.0	27.5
        		</tableData>
      		</table>
		<property>systems/electrical/fc[1]/fc-ready-for-load</property>
		<property>systems/electrical/fc[1]/bus-connector-status</property>
		<property>systems/failures/fc2-condition</property>
		</product>
		</function>
		</fcs_function>

		<switch name="systems/electrical/bus2-power-available">
			<default value="0.0"/>
			<test  value="1.0">
				systems/electrical/bus2-max-power-output-kW GT 0.0
			</test>
		</switch>

		<switch name="systems/electrical/ac2-power-available">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/bus2-power-available == 1
				systems/electrical/ac[1]/inverter-power-switch == 1
				systems/electrical/ac[1]/inv-ac-switch == 1
			</test>
		</switch>

	</channel>

	<channel name="Bus 3">

		<fcs_function name="systems/electrical/bus3-max-power-output-kW">
		<function>	
			<product>
				<property>systems/electrical/fc[2]/fc-max-power-output-kW</property>
				<property>systems/electrical/fc[2]/bus-connector-status</property>
			</product>
		</function>
		</fcs_function>

		<fcs_function name="systems/electrical/bus3-voltage">
		<function>
		<product>
		<table>
        		<independentVar lookup="row">systems/electrical/bus3-power-demand-kW</independentVar>
        		<tableData>
          	 		0.0	32.5
				12.0	27.5
        		</tableData>
      		</table>
		<property>systems/electrical/fc[2]/fc-ready-for-load</property>
		<property>systems/electrical/fc[2]/bus-connector-status</property>
		<property>systems/failures/fc3-condition</property>
		</product>
		</function>
		</fcs_function>



		<switch name="systems/electrical/bus3-power-available">
			<default value="0.0"/>
			<test value="1.0">
				systems/electrical/bus3-max-power-output-kW GT 0.0
			</test>
		</switch>

		<switch name="systems/electrical/ac3-power-available">
			<default value="0.0"/>
			<test logic="AND" value="1.0">
				systems/electrical/bus3-power-available == 1
				systems/electrical/ac[2]/inverter-power-switch == 1
				systems/electrical/ac[2]/inv-ac-switch == 1
			</test>
		</switch>

	</channel>


	<channel name="Total avilable and requested power">

		<summer name="systems/electrical/number-powered-buses">
			<input>systems/electrical/bus1-power-available</input>
			<input>systems/electrical/bus2-power-available</input>
			<input>systems/electrical/bus3-power-available</input>
		</summer>

   		<summer name="systems/electrical/total-available-power-kW">
      			<input>systems/electrical/bus1-max-power-output-kW</input>
     			<input>systems/electrical/bus2-max-power-output-kW</input>
      			<input>systems/electrical/bus3-max-power-output-kW</input>
			<input>systems/electrical/init-electrical-on</input>
   		</summer>

		<fcs_function name="systems/electrical/generic-power-demand-kW">
		<function>
			<value>8.0</value>
		</function>
		</fcs_function>

		<summer name="systems/electrical/ac1-demanded-power-kW">
			<input>systems/mps/engine/controller-A-power-demand-kW</input>
			<input>systems/mps/engine[2]/controller-B-power-demand-kW</input>
		</summer>

		<summer name="systems/electrical/ac2-demanded-power-kW">
			<input>systems/mps/engine/controller-B-power-demand-kW</input>
			<input>systems/mps/engine[1]/controller-A-power-demand-kW</input>
		</summer>

		<summer name="systems/electrical/ac3-demanded-power-kW">
			<input>systems/mps/engine[1]/controller-B-power</input>
			<input>systems/mps/engine[2]/controller-A-power</input>
		</summer>

		<summer name="systems/electrical/bus1-demanded-power-kW">
			<input>systems/electrical/ac1-demanded-power-kW</input>
			<input>systems/apu/apu/hyd-circ-pump-power-kW</input>
		</summer>

		<summer name="systems/electrical/bus2-demanded-power-kW">
			<input>systems/electrical/ac2-demanded-power-kW</input>
			<input>systems/apu/apu[1]/hyd-circ-pump-power-kW</input>
		</summer>

		<summer name="systems/electrical/bus3-demanded-power-kW">
			<input>systems/electrical/ac3-demanded-power-kW</input>
			<input>systems/apu/apu[2]/hyd-circ-pump-power-kW</input>
		</summer>

		<summer name="systems/electrical/total-demanded-power-kW">
			<input>systems/electrical/bus1-demanded-power-kW</input>
			<input>systems/electrical/bus2-demanded-power-kW</input>
			<input>systems/electrical/bus3-demanded-power-kW</input>
			<input>systems/electrical/generic-power-demand-kW</input>
			<input>systems/rcs-hardware/heater-fwd-power-kW</input>
			<input>systems/rcs-hardware/heater-left-power-kW</input>
			<input>systems/rcs-hardware/heater-right-power-kW</input>
			<input>systems/rcs-hardware/heater-fwd-1-power-kW</input>
			<input>systems/rcs-hardware/heater-fwd-2-power-kW</input>
			<input>systems/rcs-hardware/heater-fwd-3-power-kW</input>
			<input>systems/rcs-hardware/heater-fwd-4-power-kW</input>
			<input>systems/rcs-hardware/heater-fwd-5-power-kW</input>
			<input>systems/rcs-hardware/heater-aft-1-power-kW</input>
			<input>systems/rcs-hardware/heater-aft-2-power-kW</input>
			<input>systems/rcs-hardware/heater-aft-3-power-kW</input>
			<input>systems/rcs-hardware/heater-aft-4-power-kW</input>
			<input>systems/rcs-hardware/heater-aft-5-power-kW</input>
			<input>systems/oms-hardware/heater-left-power-kW</input>
			<input>systems/oms-hardware/heater-right-power-kW</input>
			<input>systems/oms-hardware/heater-crossfeed-power-kW</input>
			<input>systems/electrical/h2o-line-heater-power-kW</input>
			<input>systems/electrical/h2o-relief-heater-power-kW</input>
			<input>systems/electrical/purge-heater-power-kW</input>
		</summer>
		



		<!-- till we model this in detail, assume all buses are tied -->

		<fcs_function name="systems/electrical/power-demand-per-bus-kW">
		<function>
			<quotient>
				<property>systems/electrical/total-demanded-power-kW</property>
				<max>
				<value>0.1</value>
				<property>systems/electrical/number-powered-buses</property>
				</max>
			</quotient>
		</function>
		<output>systems/electrical/bus1-power-demand-kW</output>
		<output>systems/electrical/bus2-power-demand-kW</output>
		<output>systems/electrical/bus3-power-demand-kW</output>
		</fcs_function>

	</channel>
</system>
